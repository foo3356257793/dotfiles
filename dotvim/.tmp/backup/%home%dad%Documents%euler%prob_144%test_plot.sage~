#!/usr/bin/sage

if __name__ == "__main__":

    pl = ellipse((0,0), 5, 10, color='black')

    pl += line([(0,10.1), (1.4,-9.6)], color='red')

    m = -4 * 1.4 / -9.6

    delta = 2

    pt_0 = (1.4 - delta, -9.6 - m * delta)
    pt_1 = (1.4 + delta, -9.6 + m * delta)

    pl += line([pt_0, pt_1], color='blue')

    normal_vec = vector(RR, [-m,1])
    normal_vec = normal_vec / norm(normal_vec)

    line_vec = vector(RR, [1.4-0, -9.6-10.1])
    line_vec = line_vec / norm(line_vec)

    if line_vec[1] < 0:
        line_vec *= -1

    theta_normal = arccos(normal_vec[0])
    theta_line = arccos(line_vec[0])

    theta_new = 2*theta_normal - theta_line

    print('theta_normal = %lf' % theta_normal)
    print('theta_line = %lf' % theta_line)
    print('theta_new = %lf' % theta_new)

    new_vec = vector(RR, [cos(theta_new), sin(theta_new)])

    # 4*(1.4 + t*new_vec[0])^2 + (-9.6 + t*new_vec[1])^2 = 100
    # 4*1.4^2 + 9.6^2 + t*2*(4*1.4*new_vec[0] - 9.6*new_vec[1]) +
    # t^2*(4*new_vec[0]^2 + new_vec[1]^2) = 100
    # t = -2*(4*1.4*new_vec[0] - 9.6*new_vec[1]) / (4*new_vec[0]^2 + new_vec[1]^2)

    t = -2*(4*1.4*new_vec[0] - 9.6*new_vec[1]) / (4*new_vec[0]^2 + new_vec[1]^2)

    new_pt = t * new_vec + vector(RR, [1.4, -9.6])

    print("new_pt = %s" % new_pt)

    pl += line([(1.4,-9.6), (new_pt[0], new_pt[1])], color='red')
