use strict;
use warnings;

if(!(scalar(@ARGV) == 1 || scalar(@ARGV) == 2)){
  print "Usage: fancy_to_valid.pl fname [output]\n";
  exit(1);
}

my $fname = $ARGV[0];
my $new_fname;

if(scalar(@ARGV)==1){
  if($fname =~ /^(.*)\.cpp/){
    $new_fname = "$1_clean.cpp";
  }
  else{
    print "Expected a file with extension .cpp\n";
    exit(1);
  }
}
else{
  $new_fname = $ARGV[1];
}

print "converting $fname to $new_fname\n";

open(IN_FH, '<', $fname) or die "Cannot open file $fname: $!";
open(OUT_FH, '>', $new_fname) or die "Cannot open file $new_fname: $!";

while(<IN_FH>){

  my $line = $_;
  
  $line =~ s/รท\s*=/=divexact>/;
  $line =~ s/รท/<divexact>/;

  $line =~ s/\^/<pow>/;
  
  print OUT_FH $line;
}

close(IN_FH);
close(OUT_FH);
