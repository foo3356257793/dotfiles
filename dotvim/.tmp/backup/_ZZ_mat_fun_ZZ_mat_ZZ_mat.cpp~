ZZ_mat translate(const std::function<void(fmpz_mat_t,const fmpz_mat_t,const fmpz_mat_t)> &fun,
    const _ZZ_mat_1 &in_1, const _ZZ_mat_2 &in_2) {
  auto out = ZZ_mat(in_1.nrows(),in_2.ncols());
  fun(out.data,in_1.data,in_2.data);
  return out;
}


ZZ_mat operator+(const _ZZ_mat_1 &in_1, const _ZZ_mat_2 &in_2) {
  if(!in_1.dim_match(in_2)){
    throw std::invalid_argument("Dimensions don't match for +");
  }
  return translate(fmpz_mat_add,in_1,in_2);
}

ZZ_mat operator-(const _ZZ_mat_1 &in_1, const _ZZ_mat_2 &in_2) {
  if(!in_1.dim_match(in_2)){
    throw std::invalid_argument("Dimensions don't match for -");
  }
  return translate(fmpz_mat_sub,in_1,in_2);
}

ZZ_mat operator*(const _ZZ_mat_1 &in_1, const _ZZ_mat_2 &in_2) {
  if(!in_1.dim_rmul_match(in_2)){
    throw std::invalid_argument("Dimensions don't match for *");
  }
  return translate(fmpz_mat_mul,in_1,in_2);
}
